"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var firebase = require("nativescript-plugin-firebase/app");
var firebaseWebApi = require("nativescript-plugin-firebase/app");
// import { AngularFireModule } from 'angularfire2';
var ItemsComponent = (function () {
    function ItemsComponent() {
        // AngularFireModule.initializeApp({});
    }
    ItemsComponent.prototype.ngOnInit = function () {
        console.log("ngOnInit");
        firebase.initializeApp({
            persist: false
        }).then(function () { return console.log("Firebase initialized"); });
    };
    ItemsComponent.prototype.firestoreAdd = function () {
        firebase.firestore().collection("dogs").add({ name: "Fido" })
            .then(function (docRef) {
            console.log("Fido added, ref: " + docRef.id);
        })
            .catch(function (err) { return console.log("Adding Fido failed, error: " + err); });
    };
    ItemsComponent.prototype.firestoreSet = function () {
        firebase.firestore().collection("dogs").doc("fave")
            .set({ name: "Woofie", last: "lastofwoofie", date: new Date() }, { merge: true })
            .then(function () {
            console.log("Woofie set");
        })
            .catch(function (err) { return console.log("Setting Woofie failed, error: " + err); });
        // example from https://firebase.google.com/docs/firestore/query-data/get-data
        var citiesCollection = firebase.firestore().collection("cities");
        citiesCollection.doc("SF").set({
            name: "San Francisco",
            state: "CA",
            country: "USA",
            capital: false,
            population: 860000
        });
        citiesCollection.doc("LA").set({
            name: "Los Angeles",
            state: "CA",
            country: "USA",
            capital: false,
            population: 3900000
        });
        citiesCollection.doc("SAC").set({
            name: "Sacramento",
            state: "CA",
            country: "USA",
            capital: true,
            population: 500000
        });
        citiesCollection.doc("DC").set({
            name: "Washington, D.C.",
            state: "WA",
            country: "USA",
            capital: true,
            population: 680000
        });
        citiesCollection.doc("TOK").set({
            name: "Tokyo",
            state: null,
            country: "Japan",
            capital: true,
            population: 9000000
        });
        citiesCollection.doc("BJ").set({
            name: "Beijing",
            state: null,
            country: "China",
            capital: true,
            population: 21500000
        });
    };
    ItemsComponent.prototype.firestoreSetByAutoID = function () {
        firebase.firestore().collection("dogs").doc()
            .set({ name: "Woofie", last: "lastofwoofie", date: new Date() })
            .then(function () {
            console.log("Woofie set");
        })
            .catch(function (err) { return console.log("Setting Woofie failed, error: " + err); });
    };
    ItemsComponent.prototype.firestoreUpdate = function () {
        firebase.firestore().collection("dogs").doc("fave")
            .update({ name: "Woofieupdate", last: "updatedwoofie" })
            .then(function () {
            console.log("Woofie updated");
        })
            .catch(function (err) { return console.log("Updating Woofie failed, error: " + JSON.stringify(err)); });
    };
    ItemsComponent.prototype.firestoreGet = function () {
        var collectionRef = firebase.firestore().collection("dogs");
        collectionRef.get()
            .then(function (querySnapshot) {
            querySnapshot.forEach(function (doc) {
                console.log(doc.id + " => " + JSON.stringify(doc.data()));
            });
        })
            .catch(function (err) { return console.log("Get failed, error" + err); });
        // examples from https://firebase.google.com/docs/firestore/query-data/get-data
        var docRef = firebase.firestore().collection("cities").doc("BJ");
        docRef.get().then(function (doc) {
            if (doc.exists) {
                console.log("Document data:", JSON.stringify(doc.data()));
            }
            else {
                console.log("No such document!");
            }
        }).catch(function (error) {
            console.log("Error getting document:", error);
        });
    };
    ItemsComponent.prototype.firestoreGetNested = function () {
        var mainStreetInSFDocRef = firebase.firestore()
            .collection("cities")
            .doc("SF")
            .collection("streets")
            .doc("QZNrg22tkN8W71YC3qCb"); // id of 'main st.'
        mainStreetInSFDocRef.get().then(function (doc) {
            if (doc.exists) {
                console.log("Document data:", JSON.stringify(doc.data()));
            }
            else {
                console.log("No such document!");
            }
        }).catch(function (error) {
            console.log("Error getting document:", error);
        });
    };
    ItemsComponent.prototype.firestoreListen = function () {
        if (this.listenerUnsubscribe !== undefined) {
            console.log("Already listening ;)");
            return;
        }
        var docRef = firebase.firestore().collection("cities").doc("SF");
        this.listenerUnsubscribe = docRef.onSnapshot(function (doc) {
            if (doc.exists) {
                console.log("Document data:", JSON.stringify(doc.data()));
            }
            else {
                console.log("No such document!");
            }
        });
    };
    ItemsComponent.prototype.firestoreStopListening = function () {
        if (this.listenerUnsubscribe === undefined) {
            console.log("Please start listening first ;)");
            return;
        }
        this.listenerUnsubscribe();
        this.listenerUnsubscribe = undefined;
    };
    ItemsComponent.prototype.firestoreWhere = function () {
        var query = firebase.firestore().collection("cities")
            .where("state", "==", "CA")
            .where("population", "<", 550000);
        query
            .get()
            .then(function (querySnapshot) {
            querySnapshot.forEach(function (doc) {
                console.log("Relatively small Californian city: " + doc.id + " => " + JSON.stringify(doc.data()));
            });
        })
            .catch(function (err) { return console.log("Where-get failed, error" + err); });
    };
    ItemsComponent.prototype.firestoreWhereOrderLimit = function () {
        var query = firebase.firestore().collection("cities")
            .where("state", "==", "CA")
            .orderBy("population", "desc")
            .limit(2);
        query
            .get()
            .then(function (querySnapshot) {
            querySnapshot.forEach(function (doc) {
                console.log("Large Californian city: " + doc.id + " => " + JSON.stringify(doc.data()));
            });
        })
            .catch(function (err) { return console.log("firestoreWhereOrderLimit failed, error" + err); });
    };
    ItemsComponent.prototype.firestoreDelete = function () {
        firebase.firestore().collection("dogs").doc("fave")
            .delete()
            .then(function () {
            console.log("Woofie deleted");
        })
            .catch(function (err) { return console.log("Delete failed, error" + err); });
    };
    ItemsComponent.prototype.doWebGetValueForCompanies = function () {
        var path = "/owner";
        firebaseWebApi.database().ref(path)
            .once("value")
            .then(function (result) {
            console.log(result.key + " => " + JSON.stringify(result.val()));
        })
            .catch(function (error) { return console.log("doWebGetValueForCompanies error: " + error); });
    };
    ItemsComponent = __decorate([
        core_1.Component({
            selector: "ns-items",
            moduleId: module.id,
            templateUrl: "./items.component.html",
        }),
        __metadata("design:paramtypes", [])
    ], ItemsComponent);
    return ItemsComponent;
}());
exports.ItemsComponent = ItemsComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaXRlbXMuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiaXRlbXMuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsc0NBQWtEO0FBRWxELElBQU0sUUFBUSxHQUFHLE9BQU8sQ0FBQyxrQ0FBa0MsQ0FBQyxDQUFDO0FBQzdELElBQU0sY0FBYyxHQUFHLE9BQU8sQ0FBQyxrQ0FBa0MsQ0FBQyxDQUFDO0FBQ25FLG9EQUFvRDtBQU9wRDtJQUlFO1FBQ0UsdUNBQXVDO0lBQ3pDLENBQUM7SUFFRCxpQ0FBUSxHQUFSO1FBQ0UsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUN4QixRQUFRLENBQUMsYUFBYSxDQUFDO1lBQ3JCLE9BQU8sRUFBRSxLQUFLO1NBQ2YsQ0FBQyxDQUFDLElBQUksQ0FBQyxjQUFNLE9BQUEsT0FBTyxDQUFDLEdBQUcsQ0FBQyxzQkFBc0IsQ0FBQyxFQUFuQyxDQUFtQyxDQUFDLENBQUM7SUFDckQsQ0FBQztJQUVNLHFDQUFZLEdBQW5CO1FBQ0UsUUFBUSxDQUFDLFNBQVMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBQyxJQUFJLEVBQUUsTUFBTSxFQUFDLENBQUM7YUFDdEQsSUFBSSxDQUFDLFVBQUMsTUFBbUM7WUFDeEMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxtQkFBbUIsR0FBRyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDL0MsQ0FBQyxDQUFDO2FBQ0QsS0FBSyxDQUFDLFVBQUEsR0FBRyxJQUFJLE9BQUEsT0FBTyxDQUFDLEdBQUcsQ0FBQyw2QkFBNkIsR0FBRyxHQUFHLENBQUMsRUFBaEQsQ0FBZ0QsQ0FBQyxDQUFDO0lBQ3RFLENBQUM7SUFFTSxxQ0FBWSxHQUFuQjtRQUNFLFFBQVEsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQzthQUM5QyxH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QTZOMUI7SUFBRCxxQkFBQztDQUFBLEFBN05ELElBNk5DO0FBN05ZLHdDQUFjIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQgfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuaW1wb3J0IHsgZmlyZXN0b3JlIH0gZnJvbSBcIm5hdGl2ZXNjcmlwdC1wbHVnaW4tZmlyZWJhc2VcIjtcbmNvbnN0IGZpcmViYXNlID0gcmVxdWlyZShcIm5hdGl2ZXNjcmlwdC1wbHVnaW4tZmlyZWJhc2UvYXBwXCIpO1xuY29uc3QgZmlyZWJhc2VXZWJBcGkgPSByZXF1aXJlKFwibmF0aXZlc2NyaXB0LXBsdWdpbi1maXJlYmFzZS9hcHBcIik7XG4vLyBpbXBvcnQgeyBBbmd1bGFyRmlyZU1vZHVsZSB9IGZyb20gJ2FuZ3VsYXJmaXJlMic7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogXCJucy1pdGVtc1wiLFxuICBtb2R1bGVJZDogbW9kdWxlLmlkLFxuICB0ZW1wbGF0ZVVybDogXCIuL2l0ZW1zLmNvbXBvbmVudC5odG1sXCIsXG59KVxuZXhwb3J0IGNsYXNzIEl0ZW1zQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcblxuICBwcml2YXRlIGxpc3RlbmVyVW5zdWJzY3JpYmU6ICgpID0+IHZvaWQ7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgLy8gQW5ndWxhckZpcmVNb2R1bGUuaW5pdGlhbGl6ZUFwcCh7fSk7XG4gIH1cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICBjb25zb2xlLmxvZyhcIm5nT25Jbml0XCIpO1xuICAgIGZpcmViYXNlLmluaXRpYWxpemVBcHAoe1xuICAgICAgcGVyc2lzdDogZmFsc2VcbiAgICB9KS50aGVuKCgpID0+IGNvbnNvbGUubG9nKFwiRmlyZWJhc2UgaW5pdGlhbGl6ZWRcIikpO1xuICB9XG5cbiAgcHVibGljIGZpcmVzdG9yZUFkZCgpOiB2b2lkIHtcbiAgICBmaXJlYmFzZS5maXJlc3RvcmUoKS5jb2xsZWN0aW9uKFwiZG9nc1wiKS5hZGQoe25hbWU6IFwiRmlkb1wifSlcbiAgICAgICAgLnRoZW4oKGRvY1JlZjogZmlyZXN0b3JlLkRvY3VtZW50UmVmZXJlbmNlKSA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJGaWRvIGFkZGVkLCByZWY6IFwiICsgZG9jUmVmLmlkKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKGVyciA9PiBjb25zb2xlLmxvZyhcIkFkZGluZyBGaWRvIGZhaWxlZCwgZXJyb3I6IFwiICsgZXJyKSk7XG4gIH1cblxuICBwdWJsaWMgZmlyZXN0b3JlU2V0KCk6IHZvaWQge1xuICAgIGZpcmViYXNlLmZpcmVzdG9yZSgpLmNvbGxlY3Rpb24oXCJkb2dzXCIpLmRvYyhcImZhdmVcIilcbiAgICAgICAgLnNldCh7bmFtZTogXCJXb29maWVcIiwgbGFzdDogXCJsYXN0b2Z3b29maWVcIiwgZGF0ZTogbmV3IERhdGUoKX0sIHttZXJnZTogdHJ1ZX0pXG4gICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIldvb2ZpZSBzZXRcIik7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaChlcnIgPT4gY29uc29sZS5sb2coXCJTZXR0aW5nIFdvb2ZpZSBmYWlsZWQsIGVycm9yOiBcIiArIGVycikpO1xuXG5cbiAgICAvLyBleGFtcGxlIGZyb20gaHR0cHM6Ly9maXJlYmFzZS5nb29nbGUuY29tL2RvY3MvZmlyZXN0b3JlL3F1ZXJ5LWRhdGEvZ2V0LWRhdGFcbiAgICBjb25zdCBjaXRpZXNDb2xsZWN0aW9uID0gZmlyZWJhc2UuZmlyZXN0b3JlKCkuY29sbGVjdGlvbihcImNpdGllc1wiKTtcblxuICAgIGNpdGllc0NvbGxlY3Rpb24uZG9jKFwiU0ZcIikuc2V0KHtcbiAgICAgIG5hbWU6IFwiU2FuIEZyYW5jaXNjb1wiLFxuICAgICAgc3RhdGU6IFwiQ0FcIixcbiAgICAgIGNvdW50cnk6IFwiVVNBXCIsXG4gICAgICBjYXBpdGFsOiBmYWxzZSxcbiAgICAgIHBvcHVsYXRpb246IDg2MDAwMFxuICAgIH0pO1xuXG4gICAgY2l0aWVzQ29sbGVjdGlvbi5kb2MoXCJMQVwiKS5zZXQoe1xuICAgICAgbmFtZTogXCJMb3MgQW5nZWxlc1wiLFxuICAgICAgc3RhdGU6IFwiQ0FcIixcbiAgICAgIGNvdW50cnk6IFwiVVNBXCIsXG4gICAgICBjYXBpdGFsOiBmYWxzZSxcbiAgICAgIHBvcHVsYXRpb246IDM5MDAwMDBcbiAgICB9KTtcblxuICAgIGNpdGllc0NvbGxlY3Rpb24uZG9jKFwiU0FDXCIpLnNldCh7XG4gICAgICBuYW1lOiBcIlNhY3JhbWVudG9cIixcbiAgICAgIHN0YXRlOiBcIkNBXCIsXG4gICAgICBjb3VudHJ5OiBcIlVTQVwiLFxuICAgICAgY2FwaXRhbDogdHJ1ZSxcbiAgICAgIHBvcHVsYXRpb246IDUwMDAwMFxuICAgIH0pO1xuXG4gICAgY2l0aWVzQ29sbGVjdGlvbi5kb2MoXCJEQ1wiKS5zZXQoe1xuICAgICAgbmFtZTogXCJXYXNoaW5ndG9uLCBELkMuXCIsXG4gICAgICBzdGF0ZTogXCJXQVwiLFxuICAgICAgY291bnRyeTogXCJVU0FcIixcbiAgICAgIGNhcGl0YWw6IHRydWUsXG4gICAgICBwb3B1bGF0aW9uOiA2ODAwMDBcbiAgICB9KTtcblxuICAgIGNpdGllc0NvbGxlY3Rpb24uZG9jKFwiVE9LXCIpLnNldCh7XG4gICAgICBuYW1lOiBcIlRva3lvXCIsXG4gICAgICBzdGF0ZTogbnVsbCxcbiAgICAgIGNvdW50cnk6IFwiSmFwYW5cIixcbiAgICAgIGNhcGl0YWw6IHRydWUsXG4gICAgICBwb3B1bGF0aW9uOiA5MDAwMDAwXG4gICAgfSk7XG5cbiAgICBjaXRpZXNDb2xsZWN0aW9uLmRvYyhcIkJKXCIpLnNldCh7XG4gICAgICBuYW1lOiBcIkJlaWppbmdcIixcbiAgICAgIHN0YXRlOiBudWxsLFxuICAgICAgY291bnRyeTogXCJDaGluYVwiLFxuICAgICAgY2FwaXRhbDogdHJ1ZSxcbiAgICAgIHBvcHVsYXRpb246IDIxNTAwMDAwXG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgZmlyZXN0b3JlU2V0QnlBdXRvSUQoKTogdm9pZCB7XG4gICAgZmlyZWJhc2UuZmlyZXN0b3JlKCkuY29sbGVjdGlvbihcImRvZ3NcIikuZG9jKClcbiAgICAgICAgLnNldCh7bmFtZTogXCJXb29maWVcIiwgbGFzdDogXCJsYXN0b2Z3b29maWVcIiwgZGF0ZTogbmV3IERhdGUoKX0pXG4gICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIldvb2ZpZSBzZXRcIik7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaChlcnIgPT4gY29uc29sZS5sb2coXCJTZXR0aW5nIFdvb2ZpZSBmYWlsZWQsIGVycm9yOiBcIiArIGVycikpO1xuICB9XG5cbiAgcHVibGljIGZpcmVzdG9yZVVwZGF0ZSgpOiB2b2lkIHtcbiAgICBmaXJlYmFzZS5maXJlc3RvcmUoKS5jb2xsZWN0aW9uKFwiZG9nc1wiKS5kb2MoXCJmYXZlXCIpXG4gICAgICAgIC51cGRhdGUoe25hbWU6IFwiV29vZmlldXBkYXRlXCIsIGxhc3Q6IFwidXBkYXRlZHdvb2ZpZVwifSlcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiV29vZmllIHVwZGF0ZWRcIik7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaChlcnIgPT4gY29uc29sZS5sb2coXCJVcGRhdGluZyBXb29maWUgZmFpbGVkLCBlcnJvcjogXCIgKyBKU09OLnN0cmluZ2lmeShlcnIpKSk7XG4gIH1cblxuICBwdWJsaWMgZmlyZXN0b3JlR2V0KCk6IHZvaWQge1xuICAgIGNvbnN0IGNvbGxlY3Rpb25SZWY6IGZpcmVzdG9yZS5Db2xsZWN0aW9uUmVmZXJlbmNlID0gZmlyZWJhc2UuZmlyZXN0b3JlKCkuY29sbGVjdGlvbihcImRvZ3NcIik7XG4gICAgY29sbGVjdGlvblJlZi5nZXQoKVxuICAgICAgICAudGhlbigocXVlcnlTbmFwc2hvdDogZmlyZXN0b3JlLlF1ZXJ5U25hcHNob3QpID0+IHtcbiAgICAgICAgICBxdWVyeVNuYXBzaG90LmZvckVhY2goZG9jID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGAke2RvYy5pZH0gPT4gJHtKU09OLnN0cmluZ2lmeShkb2MuZGF0YSgpKX1gKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKGVyciA9PiBjb25zb2xlLmxvZyhcIkdldCBmYWlsZWQsIGVycm9yXCIgKyBlcnIpKTtcblxuICAgIC8vIGV4YW1wbGVzIGZyb20gaHR0cHM6Ly9maXJlYmFzZS5nb29nbGUuY29tL2RvY3MvZmlyZXN0b3JlL3F1ZXJ5LWRhdGEvZ2V0LWRhdGFcbiAgICBjb25zdCBkb2NSZWY6IGZpcmVzdG9yZS5Eb2N1bWVudFJlZmVyZW5jZSA9IGZpcmViYXNlLmZpcmVzdG9yZSgpLmNvbGxlY3Rpb24oXCJjaXRpZXNcIikuZG9jKFwiQkpcIik7XG5cbiAgICBkb2NSZWYuZ2V0KCkudGhlbigoZG9jOiBmaXJlc3RvcmUuRG9jdW1lbnRTbmFwc2hvdCkgPT4ge1xuICAgICAgaWYgKGRvYy5leGlzdHMpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJEb2N1bWVudCBkYXRhOlwiLCBKU09OLnN0cmluZ2lmeShkb2MuZGF0YSgpKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmxvZyhcIk5vIHN1Y2ggZG9jdW1lbnQhXCIpO1xuICAgICAgfVxuICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgY29uc29sZS5sb2coXCJFcnJvciBnZXR0aW5nIGRvY3VtZW50OlwiLCBlcnJvcik7XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgZmlyZXN0b3JlR2V0TmVzdGVkKCk6IHZvaWQge1xuICAgIGNvbnN0IG1haW5TdHJlZXRJblNGRG9jUmVmOiBmaXJlc3RvcmUuRG9jdW1lbnRSZWZlcmVuY2UgPVxuICAgICAgICBmaXJlYmFzZS5maXJlc3RvcmUoKVxuICAgICAgICAgICAgLmNvbGxlY3Rpb24oXCJjaXRpZXNcIilcbiAgICAgICAgICAgIC5kb2MoXCJTRlwiKVxuICAgICAgICAgICAgLmNvbGxlY3Rpb24oXCJzdHJlZXRzXCIpXG4gICAgICAgICAgICAuZG9jKFwiUVpOcmcyMnRrTjhXNzFZQzNxQ2JcIik7IC8vIGlkIG9mICdtYWluIHN0LidcblxuICAgIG1haW5TdHJlZXRJblNGRG9jUmVmLmdldCgpLnRoZW4oKGRvYzogZmlyZXN0b3JlLkRvY3VtZW50U25hcHNob3QpID0+IHtcbiAgICAgIGlmIChkb2MuZXhpc3RzKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiRG9jdW1lbnQgZGF0YTpcIiwgSlNPTi5zdHJpbmdpZnkoZG9jLmRhdGEoKSkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJObyBzdWNoIGRvY3VtZW50IVwiKTtcbiAgICAgIH1cbiAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiRXJyb3IgZ2V0dGluZyBkb2N1bWVudDpcIiwgZXJyb3IpO1xuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIGZpcmVzdG9yZUxpc3RlbigpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5saXN0ZW5lclVuc3Vic2NyaWJlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiQWxyZWFkeSBsaXN0ZW5pbmcgOylcIik7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgZG9jUmVmOiBmaXJlc3RvcmUuRG9jdW1lbnRSZWZlcmVuY2UgPSBmaXJlYmFzZS5maXJlc3RvcmUoKS5jb2xsZWN0aW9uKFwiY2l0aWVzXCIpLmRvYyhcIlNGXCIpO1xuXG4gICAgdGhpcy5saXN0ZW5lclVuc3Vic2NyaWJlID0gZG9jUmVmLm9uU25hcHNob3QoKGRvYzogZmlyZXN0b3JlLkRvY3VtZW50U25hcHNob3QpID0+IHtcbiAgICAgIGlmIChkb2MuZXhpc3RzKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiRG9jdW1lbnQgZGF0YTpcIiwgSlNPTi5zdHJpbmdpZnkoZG9jLmRhdGEoKSkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJObyBzdWNoIGRvY3VtZW50IVwiKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBmaXJlc3RvcmVTdG9wTGlzdGVuaW5nKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmxpc3RlbmVyVW5zdWJzY3JpYmUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgY29uc29sZS5sb2coXCJQbGVhc2Ugc3RhcnQgbGlzdGVuaW5nIGZpcnN0IDspXCIpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMubGlzdGVuZXJVbnN1YnNjcmliZSgpO1xuICAgIHRoaXMubGlzdGVuZXJVbnN1YnNjcmliZSA9IHVuZGVmaW5lZDtcbiAgfVxuXG4gIHB1YmxpYyBmaXJlc3RvcmVXaGVyZSgpOiB2b2lkIHtcbiAgICBjb25zdCBxdWVyeTogZmlyZXN0b3JlLlF1ZXJ5ID0gZmlyZWJhc2UuZmlyZXN0b3JlKCkuY29sbGVjdGlvbihcImNpdGllc1wiKVxuICAgICAgICAud2hlcmUoXCJzdGF0ZVwiLCBcIj09XCIsIFwiQ0FcIilcbiAgICAgICAgLndoZXJlKFwicG9wdWxhdGlvblwiLCBcIjxcIiwgNTUwMDAwKTtcblxuICAgIHF1ZXJ5XG4gICAgICAgIC5nZXQoKVxuICAgICAgICAudGhlbigocXVlcnlTbmFwc2hvdDogZmlyZXN0b3JlLlF1ZXJ5U25hcHNob3QpID0+IHtcbiAgICAgICAgICBxdWVyeVNuYXBzaG90LmZvckVhY2goZG9jID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBSZWxhdGl2ZWx5IHNtYWxsIENhbGlmb3JuaWFuIGNpdHk6ICR7ZG9jLmlkfSA9PiAke0pTT04uc3RyaW5naWZ5KGRvYy5kYXRhKCkpfWApO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goZXJyID0+IGNvbnNvbGUubG9nKFwiV2hlcmUtZ2V0IGZhaWxlZCwgZXJyb3JcIiArIGVycikpO1xuICB9XG5cbiAgcHVibGljIGZpcmVzdG9yZVdoZXJlT3JkZXJMaW1pdCgpOiB2b2lkIHtcbiAgICBjb25zdCBxdWVyeTogZmlyZXN0b3JlLlF1ZXJ5ID0gZmlyZWJhc2UuZmlyZXN0b3JlKCkuY29sbGVjdGlvbihcImNpdGllc1wiKVxuICAgICAgICAud2hlcmUoXCJzdGF0ZVwiLCBcIj09XCIsIFwiQ0FcIilcbiAgICAgICAgLm9yZGVyQnkoXCJwb3B1bGF0aW9uXCIsIFwiZGVzY1wiKVxuICAgICAgICAubGltaXQoMik7XG5cbiAgICBxdWVyeVxuICAgICAgICAuZ2V0KClcbiAgICAgICAgLnRoZW4oKHF1ZXJ5U25hcHNob3Q6IGZpcmVzdG9yZS5RdWVyeVNuYXBzaG90KSA9PiB7XG4gICAgICAgICAgcXVlcnlTbmFwc2hvdC5mb3JFYWNoKGRvYyA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgTGFyZ2UgQ2FsaWZvcm5pYW4gY2l0eTogJHtkb2MuaWR9ID0+ICR7SlNPTi5zdHJpbmdpZnkoZG9jLmRhdGEoKSl9YCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaChlcnIgPT4gY29uc29sZS5sb2coXCJmaXJlc3RvcmVXaGVyZU9yZGVyTGltaXQgZmFpbGVkLCBlcnJvclwiICsgZXJyKSk7XG4gIH1cblxuICBwdWJsaWMgZmlyZXN0b3JlRGVsZXRlKCk6IHZvaWQge1xuICAgIGZpcmViYXNlLmZpcmVzdG9yZSgpLmNvbGxlY3Rpb24oXCJkb2dzXCIpLmRvYyhcImZhdmVcIilcbiAgICAgICAgLmRlbGV0ZSgpXG4gICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIldvb2ZpZSBkZWxldGVkXCIpO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goZXJyID0+IGNvbnNvbGUubG9nKFwiRGVsZXRlIGZhaWxlZCwgZXJyb3JcIiArIGVycikpO1xuICB9XG5cbiAgcHVibGljIGRvV2ViR2V0VmFsdWVGb3JDb21wYW5pZXMoKTogdm9pZCB7XG4gICAgY29uc3QgcGF0aCA9IFwiL293bmVyXCI7XG4gICAgZmlyZWJhc2VXZWJBcGkuZGF0YWJhc2UoKS5yZWYocGF0aClcbiAgICAgICAgLm9uY2UoXCJ2YWx1ZVwiKVxuICAgICAgICAudGhlbihyZXN1bHQgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGAke3Jlc3VsdC5rZXl9ID0+ICR7SlNPTi5zdHJpbmdpZnkocmVzdWx0LnZhbCgpKX1gKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKGVycm9yID0+IGNvbnNvbGUubG9nKFwiZG9XZWJHZXRWYWx1ZUZvckNvbXBhbmllcyBlcnJvcjogXCIgKyBlcnJvcikpO1xuICB9XG59Il19